# üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Mini App

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Telegram Bot

1. **–û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)** –≤ Telegram

2. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞**:
   ```
   /newbot
   ```

3. **–í–≤–µ–¥–∏—Ç–µ –∏–º—è –±–æ—Ç–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `My Calls Bot`)

4. **–í–≤–µ–¥–∏—Ç–µ username –±–æ—Ç–∞** (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `bot`, –Ω–∞–ø—Ä–∏–º–µ—Ä: `mycalls_bot`)

5. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞** (–≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫):
   ```
   1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
   ```

6. **–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env` —Ñ–∞–π–ª**:
   ```bash
   TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
   ```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ Web App (Mini App)

1. **–í [@BotFather](https://t.me/BotFather) –≤–≤–µ–¥–∏—Ç–µ**:
   ```
   /newapp
   ```

2. **–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞** –∏–∑ —Å–ø–∏—Å–∫–∞

3. **–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `Calls`):
   ```
   Calls
   ```

4. **–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä):
   ```
   Video and audio calls via WebRTC
   ```

5. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ/–∏–∫–æ–Ω–∫—É** (512x512 px, PNG/JPG)
   - –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –Ω–∞–∂–∞–≤ `/empty`

6. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ GIF-–¥–µ–º–æ** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –Ω–∞–∂–∞–≤ `/empty`

7. **‚ö†Ô∏è –í–ê–ñ–ù–û! –í–≤–µ–¥–∏—Ç–µ URL –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**:

   **–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** (—Å ngrok):
   ```
   https://your-ngrok-url.ngrok-free.app
   ```

   **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞** (—Å –≤–∞—à–∏–º –¥–æ–º–µ–Ω–æ–º):
   ```
   https://your-domain.com
   ```

8. **–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ** (–±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –º–µ–Ω—é):
   ```
   Calls
   ```

9. **BotFather –ø—Ä–∏—à–ª—ë—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ Mini App! ‚úÖ

### –®–∞–≥ 3: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å ngrok

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞:

#### 3.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ngrok

**macOS**:
```bash
brew install ngrok
```

**Linux**:
```bash
# –°–∫–∞—á–∞—Ç—å —Å https://ngrok.com/download
wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
tar xvzf ngrok-v3-stable-linux-amd64.tgz
sudo mv ngrok /usr/local/bin/
```

**Windows**:
- –°–∫–∞—á–∞–π—Ç–µ —Å https://ngrok.com/download

#### 3.2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ ngrok

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://dashboard.ngrok.com/signup
2. –ü–æ–ª—É—á–∏—Ç–µ auth token –Ω–∞ https://dashboard.ngrok.com/get-started/your-authtoken
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ ngrok:
   ```bash
   ngrok config add-authtoken YOUR_AUTH_TOKEN
   ```

#### 3.3. –ó–∞–ø—É—Å–∫ ngrok

**–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª** –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
ngrok http 80
```

–í—ã —É–≤–∏–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:
```
Session Status                online
Account                       your@email.com
Forwarding                    https://abc123.ngrok-free.app -> http://localhost:80
```

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://abc123.ngrok-free.app`)

#### 3.4. –û–±–Ω–æ–≤–∏—Ç–µ URL Mini App

–í [@BotFather](https://t.me/BotFather):
```
/myapps
# –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
# –ù–∞–∂–º–∏—Ç–µ "Edit Web App URL"
# –í–≤–µ–¥–∏—Ç–µ ngrok URL: https://abc123.ngrok-free.app
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û–±–Ω–æ–≤–∏—Ç–µ `.env` —Ñ–∞–π–ª:

```bash
# Backend
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# Frontend (–¥–ª—è ngrok)
VITE_API_URL=https://abc123.ngrok-free.app
VITE_WS_URL=wss://abc123.ngrok-free.app
VITE_TELEGRAM_BOT_NAME=mycalls_bot
```

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã**:
```bash
make restart
```

### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Mini App

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram**

2. **–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –º–µ–Ω—é** (‚â°) –≤–Ω–∏–∑—É

3. **–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ Mini App** –∏–∑ —Å–ø–∏—Å–∫–∞

4. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è!** üéâ

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Mini App:

–í [@BotFather](https://t.me/BotFather):
```
/mybots
# –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
# Bot Settings
# Menu Button
# Edit Menu Button URL
# –í–≤–µ–¥–∏—Ç–µ URL: https://abc123.ngrok-free.app
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –±–æ—Ç–∞ –±—É–¥–µ—Ç –∫–Ω–æ–ø–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"!

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)

Telegram —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è Mini Apps. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: Let's Encrypt (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å certbot
sudo apt install certbot python3-certbot-nginx

# –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot --nginx -d your-domain.com
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: Cloudflare (–ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±)

1. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –≤ Cloudflare
2. –í–∫–ª—é—á–∏—Ç–µ "Proxy" –¥–ª—è –¥–æ–º–µ–Ω–∞
3. SSL –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ nginx –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

–°–æ–∑–¥–∞–π—Ç–µ `docker/nginx/nginx-prod.conf`:

```nginx
server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://backend:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /ws {
        proxy_pass http://backend:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

## üß™ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp API

–î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):

```javascript
// frontend/src/app/providers/TelegramProvider.tsx
useEffect(() => {
  console.log('Telegram WebApp available:', !!window.Telegram?.WebApp)
  console.log('User data:', window.Telegram?.WebApp?.initDataUnsafe?.user)
  console.log('Platform:', window.Telegram?.WebApp?.platform)
}, [])
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

–í Mini App –æ—Ç–∫—Ä–æ–π—Ç–µ DevTools (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ):
- Desktop: `Ctrl+Shift+I` –∏–ª–∏ `Cmd+Option+I`
- Telegram Desktop: –í–∫–ª—é—á–∏—Ç–µ "Debug mode" ‚Üí Tools ‚Üí Show Web Inspector

### –õ–æ–≥–∏ backend

```bash
# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
make logs-backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WebSocket
docker-compose exec backend grep -i "websocket" /app/logs/*.log
```

## üìä –ß–µ–∫–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞

- [ ] –°–æ–∑–¥–∞–Ω –±–æ—Ç —á–µ—Ä–µ–∑ @BotFather
- [ ] –ü–æ–ª—É—á–µ–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω TELEGRAM_BOT_TOKEN –≤ .env
- [ ] –°–æ–∑–¥–∞–Ω Web App —á–µ—Ä–µ–∑ /newapp
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ngrok (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- [ ] –ó–∞–ø—É—â–µ–Ω ngrok http 80
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω URL Mini App –≤ @BotFather
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω—ã VITE_API_URL –∏ VITE_WS_URL –≤ .env
- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã (make restart)
- [ ] Mini App –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏–∑ Telegram
- [ ] Telegram WebApp API –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üÜò –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### Mini App –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL**:
   ```bash
   curl https://your-ngrok-url.ngrok-free.app
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ frontend —Ä–∞–±–æ—Ç–∞–µ—Ç**:
   ```bash
   docker-compose ps frontend
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ ngrok**:
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ ngrok –∑–∞–ø—É—â–µ–Ω
   - URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å HTTPS
   - ngrok –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### "This site can't provide a secure connection"

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω—É–∂–µ–Ω SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

### Telegram WebApp API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω

- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ —á–µ—Ä–µ–∑ Telegram
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω:
  ```html
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  ```

### WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω**:
   ```bash
   curl http://localhost:8000
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –≤ backend**:
   ```python
   # backend/src/main.py
   app.add_middleware(
       CORSMiddleware,
       allow_origins=["*"],  # –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —É–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã
       allow_credentials=True,
       allow_methods=["*"],
       allow_headers=["*"],
   )
   ```

## üöÄ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à–µ Telegram Mini App –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!

–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –º–µ–Ω—é.

---

**–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?**
- Telegram Mini Apps Docs: https://core.telegram.org/bots/webapps
- ngrok Docs: https://ngrok.com/docs
